<?xml version="1.0" encoding="utf-8"?>

<!-- UI базы -->

<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark"
		xmlns:modal="views.modal.*">
	<s:layout>
		<s:VerticalLayout gap="0"/>
	</s:layout>
    
    <s:titleContent>
        <s:Button width="100%" label="{baseName}" enabled="{Boolean(baseName)}"
                  styleName="baseNameButtonStyle" click="renameBase_clickHandler(event)"/>
    </s:titleContent>
	
	<s:navigationContent>
		<s:Button label="&lt;" click="{navigator.popView();}"/>
	</s:navigationContent>
    
    <s:actionContent>
        <s:Button label="+" click="buildNewModule_clickHandler(event)"
                  enabled="{!modulesList || modulesList.length &lt; modulesLimit}"/>
    </s:actionContent>
	
    <s:List id="modulesListView" verticalScrollPolicy="on" horizontalScrollPolicy="off"
            width="100%" height="100%" change="modulesListView_changeHandler(event)"
            dataProvider="{modulesList}"/>
    
    <s:HGroup width="100%" horizontalAlign="center" gap="1">
        <s:Button maxWidth="250" label="@Resource(key='base.personnel', bundle='common')" width="50%"/>
        <s:Button maxWidth="250" label="@Resource(key='base.garrison', bundle='common')" width="50%"/>
    </s:HGroup>
    
	<fx:Declarations>
		<modal:RenameBasePopUp id="renameBasePopUp" close="renamePopUp_closeHandler(event)"/>
	</fx:Declarations>
	
	<fx:Metadata>
		[Event(name="rename", type="events.BaseEvent")]
		
		[ResourceBundle("common")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
            import mx.collections.ArrayCollection;
            import mx.core.FlexGlobals;
            import mx.managers.PopUpManager;
            import mx.utils.StringUtil;
            
            import spark.events.IndexChangeEvent;
            import spark.events.PopUpEvent;
            
            import dictionary.Const;
            
            import events.BaseEvent;
            
            import facade.ProtoFacade;
            
            import mediator.BaseMediator;
			
			//--------------------------------------------------------------------------
			// 
			//--------------------------------------------------------------------------
			
			public var buildNewBaseAvailable:Boolean = false;
			
			protected var _baseMediator:BaseMediator;
			
            private var _baseId:String;
            
			//--------------------------------------------------------------------------
			// 
			//--------------------------------------------------------------------------
			
            [Bindable]
            public var baseName:String;
            
            [Bindable]
            public var modulesList:ArrayCollection;
            
            [Bindable]
            public var modulesLimit:int;
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            /**
             * Идентификатор базы
             */
            public function get baseId():String
            {
                return _baseId;
            }
            
            protected function renamePopUp_closeHandler(event:PopUpEvent):void
            {
                if (event.data == Const.OK)
                    dispatchEvent(new BaseEvent(BaseEvent.RENAME, renameBasePopUp.baseId,
                        StringUtil.trim(renameBasePopUp.baseNameInput.text)));
            }
            
            protected function buildNewModule_clickHandler(event:MouseEvent):void
            {
                
            }
            
            protected function renameBase_clickHandler(event:MouseEvent):void
            {
                renameBasePopUp.baseName = _baseMediator.baseName;
                renameBasePopUp.baseId = _baseMediator.baseId;
                renameBasePopUp.open(DisplayObjectContainer(FlexGlobals.topLevelApplication), true);
                PopUpManager.centerPopUp(renameBasePopUp);
            }
            
            protected function modulesListView_changeHandler(event:IndexChangeEvent):void
            {
                
            }
            
            //----------------------------------
            //  Mediator
            //----------------------------------
			
            override public function set data(value:Object):void
            {
                super.data = value;
                
                _baseId = String(data);
                
                _baseMediator = BaseMediator(ProtoFacade.getInstance().retrieveMediator(BaseMediator.NAME));
                _baseMediator.setViewComponent(this);
            }
            
        ]]>
	</fx:Script>
</s:View>
