<?xml version="1.0" encoding="utf-8"?>

<!-- UI базы -->

<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark"
		xmlns:modal="views.modal.*">
	<s:layout>
		<s:VerticalLayout gap="2" paddingLeft="5" paddingRight="5"/>
	</s:layout>
    
    <s:titleContent>
        <s:Button width="100%" label="{baseName}" enabled="{Boolean(baseName)}"
                  styleName="baseNameButtonStyle" click="renameBase_clickHandler(event)"/>
    </s:titleContent>
	
	<s:navigationContent>
		<s:Button label="&lt;" click="{navigator.popView();}"/>
	</s:navigationContent>
    
    <s:VGroup width="100%" height="100%" paddingLeft="5" paddingTop="10" paddingRight="5" paddingBottom="5">
        
        <s:BorderContainer backgroundColor="#f0f0f0" borderVisible="false" width="100%" minHeight="0">
            <s:layout>
                <s:HorizontalLayout paddingLeft="2" paddingRight="2" paddingTop="2" paddingBottom="2" horizontalAlign="right" gap="2"/>
            </s:layout>
            
            <s:Button label="+" click="buildNewModule_clickHandler(event)" minWidth="42"
                      enabled="{!modulesList || modulesList.length &lt; modulesLimit}"/>
            
            <s:Button label="-" click="removeModule_clickHandler(event)" minWidth="42"
                      enabled="{modulesListView.selectedIndex >= 0}"/>
        </s:BorderContainer>
        
        <s:List id="modulesListView" verticalScrollPolicy="on" horizontalScrollPolicy="off"
                width="100%" height="100%" change="modulesListView_changeHandler(event)"
                dataProvider="{modulesList}" allowMultipleSelection="true"/>
    </s:VGroup>
    
    <s:Group width="100%">
        <s:Line left="0" right="0">
            <s:stroke>
                <s:SolidColorStroke color="#404040"/>
            </s:stroke>
        </s:Line>
    </s:Group>
    
    <s:HGroup width="100%" horizontalAlign="center" gap="1" paddingTop="5" paddingBottom="10">
        <s:Button maxWidth="250" label="@Resource(key='base.personnel', bundle='common')" width="50%"/>
        <s:Button maxWidth="250" label="@Resource(key='base.garrison', bundle='common')" width="50%"/>
    </s:HGroup>
    
	<fx:Declarations>
		<modal:RenameBasePopUp id="renameBasePopUp" close="renamePopUp_closeHandler(event)"/>
        <modal:BuildModulePopUp id="buildModulePopUp" close="buildModulePopUp_closeHandler(event)"/>
	</fx:Declarations>
	
	<fx:Metadata>
		[Event(name="rename", type="events.BaseEvent")]
        [Event(name="createModule", type="events.BaseEvent")]
		
		[ResourceBundle("common")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
            import mx.collections.ArrayCollection;
            import mx.core.FlexGlobals;
            import mx.managers.PopUpManager;
            import mx.utils.StringUtil;
            
            import spark.events.IndexChangeEvent;
            import spark.events.PopUpEvent;
            
            import dictionary.Const;
            
            import events.BaseEvent;
            
            import facade.ProtoFacade;
            
            import mediator.BaseMediator;
			
			//--------------------------------------------------------------------------
			// 
			//--------------------------------------------------------------------------
			
			public var buildNewBaseAvailable:Boolean = false;
			
			protected var _baseMediator:BaseMediator;
			
            private var _baseId:String;
            
			//--------------------------------------------------------------------------
			// 
			//--------------------------------------------------------------------------
			
            [Bindable]
            public var baseName:String;
            
            [Bindable]
            public var modulesList:ArrayCollection;
            
            [Bindable]
            public var modulesLimit:int;
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            /**
             * Идентификатор базы
             */
            public function get baseId():String
            {
                return _baseId;
            }
            
            protected function renamePopUp_closeHandler(event:PopUpEvent):void
            {
                if (event.data == Const.OK)
                    dispatchEvent(new BaseEvent(BaseEvent.RENAME, renameBasePopUp.baseId,
                        StringUtil.trim(renameBasePopUp.baseNameInput.text)));
            }
            
            protected function buildModulePopUp_closeHandler(event:PopUpEvent):void
            {
                if (event.data == Const.OK)
                    dispatchEvent(new BaseEvent(BaseEvent.CREATE_MODULE, _baseMediator.baseId,
                        uint(buildModulePopUp.moduleTypeSelector.selectedItem.id)));
            }
            
            protected function buildNewModule_clickHandler(event:MouseEvent):void
            {
                buildModulePopUp.open(DisplayObjectContainer(FlexGlobals.topLevelApplication), true);
                PopUpManager.centerPopUp(buildModulePopUp);
            }
            
            protected function removeModule_clickHandler(event:MouseEvent):void
            {
                
            }
            
            protected function renameBase_clickHandler(event:MouseEvent):void
            {
                renameBasePopUp.baseName = _baseMediator.baseName;
                renameBasePopUp.baseId = _baseMediator.baseId;
                renameBasePopUp.open(DisplayObjectContainer(FlexGlobals.topLevelApplication), true);
                PopUpManager.centerPopUp(renameBasePopUp);
            }
            
            protected function modulesListView_changeHandler(event:IndexChangeEvent):void
            {
                
            }
            
            //----------------------------------
            //  Mediator
            //----------------------------------
			
            override public function set data(value:Object):void
            {
                super.data = value;
                
                _baseId = String(data);
                
                _baseMediator = BaseMediator(ProtoFacade.getInstance().retrieveMediator(BaseMediator.NAME));
                _baseMediator.setViewComponent(this);
            }
            
        ]]>
	</fx:Script>
</s:View>
