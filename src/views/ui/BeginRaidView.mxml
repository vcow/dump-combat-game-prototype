<?xml version="1.0" encoding="utf-8"?>

<!-- UI начала нового рейда -->

<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
        xmlns:s="library://ns.adobe.com/flex/spark"
        title="{raidTitle}"
        creationComplete="creationCompleteHandler(event)" xmlns:dropDownList="com.flextras.mobile.dropDownList.*">
    <s:layout>
        <s:VerticalLayout gap="5" paddingLeft="5" paddingRight="5" paddingTop="5"/>
    </s:layout>
    
    <s:navigationContent>
        <s:Button label="&lt;" click="{navigator.popView();}"/>
    </s:navigationContent>
    
    <s:BorderContainer width="100%" cornerRadius="4">
        <s:layout>
            <s:VerticalLayout horizontalAlign="center" paddingLeft="10" paddingRight="10" paddingTop="5" paddingBottom="5"/>
        </s:layout>
        
        <s:Label text="@Resource(key='raid.departure.title', bundle='common')"/>
        
        <dropDownList:DropDownList id="departureSelector" width="100%"/>
    </s:BorderContainer>
    
    <s:BorderContainer width="100%" height="100%" cornerRadius="4">
        <s:layout>
            <s:VerticalLayout gap="4" paddingLeft="5" paddingRight="5" paddingBottom="5" paddingTop="5" horizontalAlign="center"/>
        </s:layout>
        
        <s:Label text="@Resource(key='raid.squad.title', bundle='common')"/>
        
        <s:Scroller width="100%" height="100%" horizontalScrollPolicy="off">
            
            <s:DataGroup width="100%" dataProvider="{unitsList}">
                <s:layout>
                    <s:VerticalLayout gap="0" paddingRight="5"/>
                </s:layout>
                
            </s:DataGroup>
        </s:Scroller>
    </s:BorderContainer>
    
    <s:HGroup width="100%" paddingTop="5" paddingBottom="5" horizontalAlign="center">
        
        <s:Button label="@Resource(key='raid.get.button', bundle='common')" width="100"/>
    </s:HGroup>
    
    <fx:Declarations>
    </fx:Declarations>
    
    <fx:Metadata>
        [ResourceBundle("common")]
    </fx:Metadata>
    
    <fx:Script>
        <![CDATA[
            import mx.collections.ArrayCollection;
            import mx.events.FlexEvent;
            
            import dictionary.Const;
            
            import facade.ProtoFacade;
            
            import mediator.BeginRaidMediator;
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            private var _beginRaidMediator:BeginRaidMediator;
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            [Bindable]
            private var raidTitle:String;
            
            [Bindable]
            private var unitsList:ArrayCollection;
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            /**
             * Обновить содержимое
             */
            public function updateList():void
            {
                if (!_beginRaidMediator)
                    return;
                
                raidTitle = resourceManager.getString("common", "raid.title", [ _beginRaidMediator.targetName ]);
                unitsList = _beginRaidMediator.unitsList;
            }
            
            /**
             * Идентификатор базы, на которую производится нападение
             */
            public function get tagetBaseId():String
            {
                return data ? data.toString() : Const.NO_GUID;
            }
            
            //--------------------------------------------------------------------------
            // 
            //--------------------------------------------------------------------------
            
            protected function creationCompleteHandler(event:FlexEvent):void
            {
                _beginRaidMediator = BeginRaidMediator(ProtoFacade.getInstance().retrieveMediator(BeginRaidMediator.NAME));
                _beginRaidMediator.setViewComponent(this);
                
                updateList();
            }
            
            //----------------------------------
            //  View
            //----------------------------------
            
            override public function set data(value:Object):void
            {
                super.data = value;
                updateList();
            }
            
        ]]>
    </fx:Script>
</s:View>
